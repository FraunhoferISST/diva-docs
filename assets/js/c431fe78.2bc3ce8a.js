"use strict";(self.webpackChunkdiva_docs=self.webpackChunkdiva_docs||[]).push([[8297],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),s=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(n),m=r,h=u["".concat(c,".").concat(m)]||u[m]||p[m]||o;return n?a.createElement(h,i(i({ref:t},d),{},{components:n})):a.createElement(h,i({ref:t},d))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6548:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return p}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=["components"],l={id:"keycloak",title:"Keycloak"},c="Keycloak",s={unversionedId:"Development/Architecture/keycloak",id:"Development/Architecture/keycloak",title:"Keycloak",description:"Keycloak is a popular Open Source identity and access management software. In DIVA v2.2 we",source:"@site/docs/04-Development/04-Architecture/04-keycloak.md",sourceDirName:"04-Development/04-Architecture",slug:"/Development/Architecture/keycloak",permalink:"/docs/Development/Architecture/keycloak",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{id:"keycloak",title:"Keycloak"},sidebar:"divaSidebar",previous:{title:"REST API",permalink:"/docs/Development/Architecture/rest-api"},next:{title:"Gateway",permalink:"/docs/Development/Architecture/gateway"}},d={},p=[{value:"Deployment",id:"deployment",level:2},{value:"Realm",id:"realm",level:2},{value:"Authentication",id:"authentication",level:2},{value:"Users management",id:"users-management",level:2}],u={toc:p};function m(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"keycloak"},"Keycloak"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.keycloak.org/"},"Keycloak")," is a popular Open Source identity and access management software. In DIVA v2.2 we\nintegrated Keycloak to 1) reuse enterprise ready identity and user account management that Keycloak provides out of the box and\n2) to open for the companies the possibility to configure more granular the access and authentication flow in DIVA."),(0,o.kt)("h2",{id:"deployment"},"Deployment"),(0,o.kt)("p",null,"DIVA is shipped with already ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/FraunhoferISST/diva/blob/main/core/keycloak/default-realm.json"},"preconfigured"),"\nKeycloak 15 instance that can be started up directly with the other components. You will\nfind more details in the ",(0,o.kt)("a",{parentName:"p",href:"../../deployment/docker"},"Docker guide"),". The provided configuration has a realm with all necessary\nsettings to accept Web-Client connections and authorize users."),(0,o.kt)("h2",{id:"realm"},"Realm"),(0,o.kt)("p",null,"The pre-configured realm is automatically loaded into DIVA Keycloak at startup and has a client for DIVA Web app.\nThe default names for the realm and client are ",(0,o.kt)("inlineCode",{parentName:"p"},"diva-kc-realm")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"diva-kc-client"),". This names are not mandatory and\ncan be changed. You have only to reflect the name changes in the ",(0,o.kt)("a",{parentName:"p",href:"web-client#configuration"},"Web client configuration"),".\nFor the local development environment all values can be used as provided in default configuration."),(0,o.kt)("h2",{id:"authentication"},"Authentication"),(0,o.kt)("p",null,"The Kong API Gateway uses from Keycloak issued JWT tokens to authenticate users for further access to the DIVA\nAPI. By default, we use tokens with RS256 signature algorithm with default expiration policies. The Web-Client checks the token validity every\n",(0,o.kt)("strong",{parentName:"p"},"60")," seconds."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"If you change token settings in Keycloak, probably the adjustment in the API Gateway will be required. For more details refer\nto ",(0,o.kt)("a",{parentName:"p",href:"gateway"},"Kong configuration"),"."))),(0,o.kt)("h2",{id:"users-management"},"Users management"),(0,o.kt)("p",null,"DIVA uses Keycloak ",(0,o.kt)("strong",{parentName:"p"},"only")," as identity management and log in service. That means all users date except ",(0,o.kt)("inlineCode",{parentName:"p"},"email")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"password"),"\nare still managed in DIVA. DIVA users have additional fields like ",(0,o.kt)("inlineCode",{parentName:"p"},"username"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"jobTitle"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"company")," etc. and a profile image.\nAll this data can be edited only in DIVA Web-client and the changes does not affect Keycloak users state."),(0,o.kt)("p",null,"The users from Keycloak are transferred to DIVA at login or register. Each time someone logs in or registers via Keycloak,\nthe user data is updated in DIVA or a new user is created, if it does not yet exist in DIVA. This means that email and password can\nbe updated in Keycloak, but only email and password. "),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Users attributes")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Please note that in DIVA we only import the ",(0,o.kt)("strong",{parentName:"p"},"email")," of the keycloak user.\nThe changes of the other user attributes in DIVA do not affect Keycloak and vice versa."))))}m.isMDXComponent=!0}}]);