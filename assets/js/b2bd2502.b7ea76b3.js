"use strict";(self.webpackChunkdiva_docs=self.webpackChunkdiva_docs||[]).push([[9449],{3905:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return u}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),d=p(n),u=o,k=d["".concat(s,".").concat(u)]||d[u]||c[u]||r;return n?a.createElement(k,i(i({ref:t},m),{},{components:n})):a.createElement(k,i({ref:t},m))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9146:function(e,t,n){n.r(t),n.d(t,{assets:function(){return m},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return c}});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=["components"],l={id:"docker-deployment",title:"Docker Deployment"},s="Docker Deployment",p={unversionedId:"Development/Development/docker-deployment",id:"Development/Development/docker-deployment",title:"Docker Deployment",description:"DIVA is built with a focus on scalability, modularisation and expandability using a microservice architecture. Our team",source:"@site/docs/04-Development/03-Development/02-docker-deployment.md",sourceDirName:"04-Development/03-Development",slug:"/Development/Development/docker-deployment",permalink:"/docs/Development/Development/docker-deployment",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"docker-deployment",title:"Docker Deployment"},sidebar:"divaSidebar",previous:{title:"Local Development",permalink:"/docs/Development/Development/local-development"},next:{title:"Overview",permalink:"/docs/Development/Architecture/introduction"}},m={},c=[{value:"Environment variables",id:"environment-variables",level:2},{value:"Container and images management",id:"container-and-images-management",level:2},{value:"Manage microservices",id:"manage-microservices",level:3},{value:"Manage FaaS",id:"manage-faas",level:3},{value:"Manage Airflow",id:"manage-airflow",level:3},{value:"Manage base images",id:"manage-base-images",level:3}],d={toc:c};function u(e){var t=e.components,n=(0,o.Z)(e,i);return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"docker-deployment"},"Docker Deployment"),(0,r.kt)("p",null,"DIVA is built with a focus on scalability, modularisation and expandability using a microservice architecture. Our team\nrelies on the latest technologies for container-based development and deployment of the system using Docker.\nAll system components are containerized and have current images that are\ncontinuously built in the CI pipeline. In this guide we will learn how to get DIVA running with ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose"),"."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Make sure to read the ",(0,r.kt)("a",{parentName:"p",href:"../prerequisites"},"prerequisites")," to know what you need to get started with Docker and Docker Compose.\nAlso note that deployment with docker is not suitable for Production. Nonetheless, it is convenient for local development\nenvironment to quickly spin up most of the components like Kafka, Gateway and other services."))),(0,r.kt)("p",null,"All things related to docker are located in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/FraunhoferISST/diva/blob/master/docker"},(0,r.kt)("inlineCode",{parentName:"a"},"docker/")),"\ndirectory. Here we have prepared a script which you can use to directly boot\nall components, with default environment setup. If you need a quick start,\njust execute the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# navigate to docker/ directory\ncd docker\n# spin up the system\n./up_core.sh\n")),(0,r.kt)("p",null,"The script starts all core services, profiling workflow engine, DSC and the web client application. It may take some\ntime until all components are up and running. By default, the client should be available on ",(0,r.kt)("inlineCode",{parentName:"p"},"localhost:70"),"."),(0,r.kt)("p",null,"If you want to learn more about the configuration options, the following chapters will show you\nhow to manage Docker containers, images and deployment."),(0,r.kt)("h2",{id:"environment-variables"},"Environment variables"),(0,r.kt)("p",null,"First with the environment variables you have the possibility to propagate settings to the containers on run time.\nThe ENV's are used to configure exposed ports, Kafka topics, database connections, credentials etc. This makes the deployment\nof containers more flexible and provides you a way to configure the environment without potential collisions with other software\non your machines."),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Ports allocation")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"DIVA components allocate many default ports like 80, 3000 or 27017. To avoid potential conflicts on deployment, most of the allocated ports can\nbe configured in ",(0,r.kt)("inlineCode",{parentName:"p"},"docker/.env")," file."))),(0,r.kt)("p",null,"All available configuration possibilities are listed in the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/FraunhoferISST/diva/blob/master/docker/.env.default"},(0,r.kt)("inlineCode",{parentName:"a"},"docker/.env.default"))," file.\nThis ENV template is used by default to boot the system with ",(0,r.kt)("inlineCode",{parentName:"p"},"up_core.sh")," script. To override default settings, create\na ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file in the ",(0,r.kt)("inlineCode",{parentName:"p"},"docker/")," directory and copy the contents of ",(0,r.kt)("inlineCode",{parentName:"p"},".env.default")," to it. There you can adjust the deployment,",(0,r.kt)("br",{parentName:"p"}),"\n","and e.g. change the port of the web application as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-env"},"WEB_CLIENT_PORT=90\n")),(0,r.kt)("h2",{id:"container-and-images-management"},"Container and images management"),(0,r.kt)("p",null,"Now we will briefly go through the lifecycle of containers and images, from configuration to deployment in the container registry.\nThis chapter is interesting for those who want to actively participate in the development of the system or manage\ncontainers and images in a more granular way. "),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Environment variables")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Make sure to create ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file on your machine like described in ",(0,r.kt)("a",{parentName:"p",href:"#environment-variables"},"Environment variables")))),(0,r.kt)("p",null,"We will take a brief look at how to build, push, and pull images in general.\nOf course, this chapter only concerns the software we have created and containerized, external images like Kafka or Elasticsearch are not of interest to us.\nIn general, you will find multiple Docker Compose files that have the following responsibilities:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/FraunhoferISST/diva/blob/master/docker/docker-compose.yml"},(0,r.kt)("inlineCode",{parentName:"a"},"docker-compose.yml"))," - the most\ninteresting config file as it is a heart of the DIVA")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/FraunhoferISST/diva/blob/master/docker/docker-compose.faas.yml"},(0,r.kt)("inlineCode",{parentName:"a"},"docker-compose.faas.yml"))," - FaaS services configuration useful only\nfor local development to build and test images\n")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/FraunhoferISST/diva/blob/master/docker/docker-compose.airflow.yml"},(0,r.kt)("inlineCode",{parentName:"a"},"docker-compose.airflow.yml"))," - Airflow configuration")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/FraunhoferISST/diva/blob/master/docker/docker-compose.profiling.yml"},(0,r.kt)("inlineCode",{parentName:"a"},"docker-compose.profiling.yml"))," - external profiling services\nused in our profiling workflows")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/FraunhoferISST/diva/blob/master/docker/docker-compose.monitoring.yml"},(0,r.kt)("inlineCode",{parentName:"a"},"docker-compose.monitoring.yml"))," - several helpful monitoring\nand debugging tools like Kibana that are not deployed within the system core")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/FraunhoferISST/diva/blob/master/docker/docker-compose.dsc.yml"},(0,r.kt)("inlineCode",{parentName:"a"},"docker-compose.dsc.yml"))," - DSC Service, for demonstration purpose only"))),(0,r.kt)("p",null,"The folder also contains other Docker Compose configurations that have ",(0,r.kt)("inlineCode",{parentName:"p"},".build")," in the suffix. These can override the\nnormal configurations to build an image locally explicitly from source. The difference with the ",(0,r.kt)("inlineCode",{parentName:"p"},".build")," configurations\nis that the services are executed in the context of the corresponding folder.\nGenerally, the configuration can be overwritten as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -f docker-compose.build.yml build resource-management\n")),(0,r.kt)("h3",{id:"manage-microservices"},"Manage microservices"),(0,r.kt)("p",null,"All microservices and their dependencies are defined in ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.yml"),". You will work with this file the most."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Pull image")),(0,r.kt)("p",null,"Simply run the command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose pull <service_name>\n# for example\ndocker-compose pull user-management\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Build image")),(0,r.kt)("p",null,"To explicitly build the image from source, specify the path to the override ",(0,r.kt)("inlineCode",{parentName:"p"},".yml")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose f docker-compose.yml -f docker-compose.override.yml build <service_name>\n# for example\ndocker-compose f docker-compose.yml -f docker-compose.override.yml build user-management\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Push image")),(0,r.kt)("p",null,"Push image to container registry:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose push <service_name>\n# for example\ndocker-compose push user-management\n")),(0,r.kt)("h3",{id:"manage-faas"},"Manage FaaS"),(0,r.kt)("p",null,"All FaaS are defined in ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.faas.yml"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Pull image")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -f docker-compose.faas.yml pull <service_name>\n# for example\ndocker-compose -f docker-compose.faas.yml pull text-keywords-extractor\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Build image")),(0,r.kt)("p",null,"To explicitly build the image from source, specify the path to the build ",(0,r.kt)("inlineCode",{parentName:"p"},".yml")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -f docker-compose.faas.yml -f docker-compose.faas.build.yml build <service_name>\n# for example\ndocker-compose -f docker-compose.faas.yml -f docker-compose.faas.build.yml build text-keywords-extractor\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Push image")),(0,r.kt)("p",null,"Push image to container registry:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -f docker-compose.faas.yml push text-keywords-extractor\n# for example\ndocker-compose -f docker-compose.faas.yml push text-keywords-extractor\n")),(0,r.kt)("h3",{id:"manage-airflow"},"Manage Airflow"),(0,r.kt)("p",null,"We use a slightly customized image for Airflow. The definitions for Airflow\nare specified in",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose.airflow.yml"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Pull image")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker pull ghcr.io/fraunhoferisst/diva/airflow:<version>\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Build image")),(0,r.kt)("p",null,"To explicitly build the image from source, specify the path to the build ",(0,r.kt)("inlineCode",{parentName:"p"},".yml")," :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -f docker-compose.airflow.build.yml build airflow\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Push image")),(0,r.kt)("p",null,"Push image to container registry:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose -f docker-compose.airflow.yml push airflow\n")),(0,r.kt)("h3",{id:"manage-base-images"},"Manage base images"),(0,r.kt)("p",null,"We have several images that serve as the basis for our FaaS. They are located in ",(0,r.kt)("inlineCode",{parentName:"p"},"./base-images"),", so first\nchange the working directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"cd base-images\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Pull image")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose pull <service_name>\n# for example\ndocker-compose pull base-python3\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Build image")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose build <service_name>\n# for example\ndocker-compose build base-python3\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Push image")),(0,r.kt)("p",null,"Push image to container registry:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"docker-compose push <service_name>\n# for example\ndocker-compose push base-python3\n")))}u.isMDXComponent=!0}}]);