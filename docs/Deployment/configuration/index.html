<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-3.3.1 plugin-docs plugin-id-default docs-doc-id-Deployment/configuration">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="alternate" type="application/rss+xml" href="/diva-docs/blog/rss.xml" title="DIVA Guide RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/diva-docs/blog/atom.xml" title="DIVA Guide Atom Feed"><title data-rh="true">Configuration | DIVA Guide</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://fraunhoferisst.github.io//diva-docs/docs/Deployment/configuration"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="3.3.1"><meta data-rh="true" name="docusaurus_tag" content="docs-default-3.3.1"><meta data-rh="true" name="docsearch:version" content="3.3.1"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-3.3.1"><meta data-rh="true" property="og:title" content="Configuration | DIVA Guide"><meta data-rh="true" name="description" content="When building DIVA we rely on established opens source solutions for creating a scalable and transparent architecture."><meta data-rh="true" property="og:description" content="When building DIVA we rely on established opens source solutions for creating a scalable and transparent architecture."><link data-rh="true" rel="icon" href="/diva-docs/img/logos/diva_logo.ico"><link data-rh="true" rel="canonical" href="https://fraunhoferisst.github.io//diva-docs/docs/Deployment/configuration"><link data-rh="true" rel="alternate" href="https://fraunhoferisst.github.io//diva-docs/docs/Deployment/configuration" hreflang="en"><link data-rh="true" rel="alternate" href="https://fraunhoferisst.github.io//diva-docs/docs/Deployment/configuration" hreflang="x-default"><link rel="stylesheet" href="/diva-docs/assets/css/styles.e5350093.css">
<link rel="preload" href="/diva-docs/assets/js/runtime~main.8823692d.js" as="script">
<link rel="preload" href="/diva-docs/assets/js/main.a798bc63.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="announcementBarContent_xLdY">⭐️ If you like DIVA, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/FraunhoferISST/diva">GitHub</a> ⭐️</div><button type="button" class="clean-btn close announcementBarClose_gvF7" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/diva-docs/"><div class="navbar__logo"><img src="/diva-docs/img/logos/diva_logo_1000_1000.png" alt="DIVA Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/diva-docs/img/logos/diva_logo_1000_1000.png" alt="DIVA Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">DIVA Guide</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/diva-docs/docs/introduction">3.3.1</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/diva-docs/docs/next/Deployment/configuration">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/diva-docs/docs/Deployment/configuration">3.3.1</a></li></ul></div><a class="navbar__item navbar__link" href="/diva-docs/about">About</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/diva-docs/docs/introduction">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/FraunhoferISST/diva" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link icon" title="View on GitHub">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/diva-docs/"><img src="/diva-docs/img/logos/diva_logo_1000_1000.png" alt="DIVA Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/diva-docs/img/logos/diva_logo_1000_1000.png" alt="DIVA Logo" class="themedImage_ToTc themedImage--dark_i4oU"><b>DIVA Guide</b></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/diva-docs/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/diva-docs/docs/User-Docs/introduction">User-Docs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/diva-docs/docs/Deployment/introduction">Deployment</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diva-docs/docs/Deployment/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diva-docs/docs/Deployment/prerequisites">Prerequisites</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diva-docs/docs/Deployment/docker">Docker Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/diva-docs/docs/Deployment/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diva-docs/docs/Deployment/releases">Releases and Migrations</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/diva-docs/docs/Development/introduction">Development</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/diva-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Deployment</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Configuration</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 3.3.1</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Configuration</h1><p>When building DIVA we rely on established opens source solutions for creating a scalable and transparent architecture.
We try to pick the best technologies like MongoDB, Elasticsearch or Kafka and others for communication of internal
components and persistent storage to focus on DIVA specific logic. Since we cannot know in which environments DIVA could
be deployed, we do not want to make strict assumptions about the necessary configuration of the external software.</p><p>Potentially, all external components can be configured flexibly. You can deploy and scale them where and how you want.
The only requirement is - our DIVA internal components still know how to connect to the external components.
The whole system can be configured through the environment variables.
You can customize all variables in <code>docker/.env</code>. For more specific requirements, you can also set the variables for individual services.
The variables are documented in corresponding README&#x27;s.</p><p>In the following we will go through the main configuration steps and learn how to best prepare DIVA for production environment.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="keycloak">Keycloak<a class="hash-link" href="#keycloak" title="Direct link to heading">​</a></h2><p><a href="https://www.keycloak.org/" target="_blank" rel="noopener noreferrer">Keycloak</a> is a popular Open Source identity and access management software. In DIVA v2.2 we
integrated Keycloak to 1) reuse enterprise ready identity and user account management that Keycloak provides out of the box and
2) to open for the companies the possibility to configure more granular access and authentication flow in DIVA.
In this guide we assume that you are already familiar with the basic concepts of Keycloak.</p><p>DIVA is shipped with already <a href="https://github.com/FraunhoferISST/diva/blob/main/core/keycloak/default-realm.json" target="_blank" rel="noopener noreferrer">preconfigured</a>
Keycloak 15 instance that can be started up directly with the other components. You will
find more details in the <a href="/diva-docs/docs/Deployment/docker">Docker guide</a>. The provided configuration has a realm with all necessary
settings to accept Web-Client connections and authorize users. Nevertheless, this configuration must be optimized for
production environment to improve the security setting.</p><p>DIVA can also be used with own managed Keycloak instance. In this case you just have to configure <a href="#web-client">Web client</a> and
<a href="#kong-gateway">API Gateway</a> to work with your Keycloak.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Default realm configuration</h5></div><div class="admonition-content"><p>The provided configuration is very minimal and has only a set of features required for DIVA to function properly. You have
to adjust the security setting corresponding to your policies and enable further features like emailing through advanced
Keycloak configuration.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="environment">Environment<a class="hash-link" href="#environment" title="Direct link to heading">​</a></h3><p>First, Keycloak must be configured in Docker through the <a href="/diva-docs/docs/Deployment/docker#environment-variables#environment-variables">environment variables</a>.
To do this, we need to explicitly tell Keycloak in your <code>docker/.env</code> on which URL the instance is running.
For example, if you plan to deploy Keycloak on <code>https://diva.com/auth/</code>, we set the variable as follows:</p><div class="language-dotenv codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dotenv codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">KEYCLOAK_FRONTEND_URL=https://diva.com/auth/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Below is the list of important variables:</p><div class="language-dotenv codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dotenv codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">KEYCLOAK_PORT=7000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KEYCLOAK_USER=admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KEYCLOAK_PASSWORD=my_secure_password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KEYCLOAK_DB_USER=keycloak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KEYCLOAK_DB_PASSWORD=my_secure_password</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Change credentials</h5></div><div class="admonition-content"><p>Make sure to use secure Keycloak and Postgres usernames and passwords passed through the ENV&#x27;s!</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="realm">Realm<a class="hash-link" href="#realm" title="Direct link to heading">​</a></h3><p>The pre-configured realm is automatically loaded into DIVA Keycloak at startup and has a client for DIVA Web app.
The default names for the realm and client are <code>diva-kc-realm</code> and <code>diva-kc-client</code>. This names are not mandatory and
can be changed. You have only to reflect the name changes in the <a href="#web-client">Web Client configuration</a>.</p><p>To restrict access to the DIVA Keycloak, the redirect and origin URL&#x27;s must be adjusted in the client. For this we have to
navigate to Keycloak admin console on <code>https://diva.com/auth/admin/master/console/#/realms/diva-kc-realm</code> and
under <strong>Clients</strong> -&gt; <code>diva-kc-client</code> -&gt; <strong>Settings</strong> set the <strong>Valid Redirect URIs</strong> and <strong>Web Origins</strong> options.
These options must contain URL&#x27;s under which the Web-client can be reached. For example if the client is deployed on <code>https://diva.com/</code>,
we set the setting like follows:</p><ul><li>Valid Redirect URIs: <code>https://diva.com*</code></li><li>Web origins: <code>https://diva.com</code></li></ul><p>For the local development environment all values can be used as provided in the default configuration.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="authentication">Authentication<a class="hash-link" href="#authentication" title="Direct link to heading">​</a></h3><p>The Kong API Gateway uses JWT tokens issued by Keycloak to authenticate users for further access to the DIVA
API. By default, we use tokens with RS256 signature algorithm with default expiration policies. The Web Client checks the token validity every
<strong>60</strong> seconds.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>If you change token settings in Keycloak, probably the adjustment in the API Gateway will be required. For more details refer
to <a href="#kong-gateway">Kong configuration</a>.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="users-management">Users management<a class="hash-link" href="#users-management" title="Direct link to heading">​</a></h3><p>DIVA uses Keycloak <strong>only</strong> as identity management and log in service. That means all users date except <code>email</code> and <code>password</code>
are still managed in DIVA. DIVA users have additional fields like <code>username</code>, <code>jobTitle</code>, <code>company</code> etc. and a profile image.
All this data can be edited only in DIVA Web-client and the changes does not affect Keycloak users state.</p><p>The users from Keycloak are transferred to DIVA at login or register. Each time someone logs in or registers via Keycloak,
the user data is updated in DIVA or a new user is created, if it does not yet exist in DIVA. This means that email and password can
be updated in Keycloak, but only email and password.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Users attributes</h5></div><div class="admonition-content"><p>Please note that we only import the <strong>email</strong> of the keycloak user in DIVA.
The changes of other users attributes in DIVA do not affect Keycloak and vice versa.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="kong-gateway">Kong Gateway<a class="hash-link" href="#kong-gateway" title="Direct link to heading">​</a></h2><p>The <a href="https://konghq.com/kong/" target="_blank" rel="noopener noreferrer">Kong</a> API Gateway acts as a secure access point to the backend services. It is an abstraction layer for the REST API&#x27;s
of the individual services used by our <a href="#web-client">Web client</a>. Gateway provides an authentication mechanism and accepts
requests only from the clients with a valid <a href="https://jwt.io/" target="_blank" rel="noopener noreferrer">JWT</a>. So the gateway is the security layer in the
entire system and should be the only component accessible on the Internet. The backend of the system should always run
behind the gateway, since the services themselves do not implement any authentication.</p><p>As of DIVA v2.2 we use Keycloak as identity provider and user authorization service.
The client sends the JWT tokens created by Keycloak in each request. Kong uses the token to authenticate the
user by checking the token signature with the Keycloak public key.</p><p>This is the default flow for authorization and authentication by Keycloak and Kong, but it can be flexibly adjusted.
If e.g. a different algorithm is used in Keycloak for token creation, Kong configuration must be adjusted accordingly so
that Kong can correctly authenticate a user.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="declarative-configuration">Declarative Configuration<a class="hash-link" href="#declarative-configuration" title="Direct link to heading">​</a></h3><p>The Kong Gateway upstream services are configured through the declarative <a href="https://github.com/FraunhoferISST/diva/blob/master/core/kong-gateway/kong.yml" target="_blank" rel="noopener noreferrer"><code>kong.yml</code></a>.
Here you can regulate access to the service and enable or disable authentication for some routes or methods.
To understand the configuration, we recommend reading the documentation on Kong.</p><p>The <code>kong.yml</code> contains configuration that is in no way suitable for production environment and is only useful for
local development. We strongly encourage you to create and use other rather appropriate declarative configuration. As a baseline we
provide you with an example configuration in <a href="https://github.com/FraunhoferISST/diva/blob/master/core/kong-gateway/kong.production.yml" target="_blank" rel="noopener noreferrer"><code>kong.production.yml</code></a>.</p><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Exposed credentials</h5></div><div class="admonition-content"><p>All sensitive information in default <code>kong.yml</code> and <code>kong.production.yml</code> is exposed on GitHub. Make sure to not copy and paste any secrets or passwords
from the default publicity visible configurations!</p></div></div><p>When deploying with Docker, you can easily switch between configurations with the <code>KONG_DECLARATIVE_CONFIG</code> environment variable.
Please read more in our <a href="/diva-docs/docs/deployment/docker#environment-variables">Docker guide</a> about environment variables. For example,
you can place your configuration in <code>core/kong-gateway/my-production-config.yml</code> and set the ENV in your <code>.env</code> file:</p><div class="language-dotenv codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dotenv codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">KONG_DECLARATIVE_CONFIG=my-production-config.yml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The next important point is that Kong needs to know the Keycloak token issuer for authentication. The field <code>iss</code> in
Keycloak generated token depends on how <a href="#keycloak">Keycloak is configured</a> and on which URL it lives. Fo example, if the
Keycloak instance is located on <code>https://my.kc.domain.com</code>, you have to adjust the following everywhere authentication is required:</p><div class="language-yml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jwt</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">keycloak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">allowed_iss</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://my.kc.domain.com/auth/realms/&lt;realm-name&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And again, <code>realm-name</code> depends on how your Keycloak is configured to be used in DIVA. In the default configuration
shipped with DIVA the realm name is <code>diva-kc-realm</code>. In general the <code>iss</code> URL origin part should correspond to with
<code>KEYCLOAK_FRONTEND_URL</code> ENV specified URL origin.
The resulting URL is used from <a href="https://github.com/gbbirkisson/kong-plugin-jwt-keycloak" target="_blank" rel="noopener noreferrer"><code>kong-plugin-jwt-keycloak</code></a>
to fetch the Keycloak public key and authenticate the user. It is important to note, that if you change the JWT token creation
in Keycloak (e.g. signature algorithm), the provided token authentication may fail and you have to fix it on your own in your
<code>my-production-config.yml</code> or create an issue and request the changes.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="web-client">Web client<a class="hash-link" href="#web-client" title="Direct link to heading">​</a></h2><p>DIVA is a complex system with many services and different interfaces that drive the core functionality of the system.
Operating the system requires a solid understanding of the underlying architecture and the technologies used.
To enable everyone to enjoy the benefits of data management with DIVA, we have implemented a web-based client application.</p><p>The client communicates with the backend through Kong API Gateway and requires the user to be authenticated with a valid JWT.</p><p>Once loaded, the client performs the identity check through Keycloak and initializes the user data in the browser, if user exists
and is already logged in, or navigates to login page. There the authorization to the system is managed by <a href="#keycloak">Keycloak</a>.</p><p>For the web client, in order to be able to execute identity verification and access API Gateway, corresponding information
should be configured.
The app can be configured by several environment variables and is shipped from a containerized Nginx server over the internet to the browser. The communication
on <code>localhost</code> is not possible anymore and you have at least to configure correct URL&#x27;s where client can rich Keycloak and API Gateway
instances.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>ENV&#x27;s on runtime</h5></div><div class="admonition-content"><p>Yes, you do not have to rebuild the web-client Docker image every time any of the ENV&#x27;s changes. The environment variables are injected
in the app source code on each container start. You can adjust all accepted ENV&#x27;s at any time without the need to build own image, just restart the container!</p></div></div><p>In the following we will list and explain environment variables that can be configured in you <code>docker/.env</code> and are automatically
injected on runtime:</p><ul><li><p><code>VUE_APP_API_GATEWAY_URL</code>- the client must know how to reach the gateway and uses the <code>VUE_APP_API_GATEWAY_URL</code> environment variable as the base URL. You can
learn more about how to deploy web-client and the Gateway with reverse proxy in our <a href="/diva-docs/docs/deployment/docker#deployment-with-nginx-reverse-proxy">Docker guide</a>.</p></li><li><p><code>VUE_APP_KEYCLOAK_URL</code> - the client must also know how to reach the Keycloak instance for user authorization.
Here applies the same, in production the variable must be set correctly so that the client can communicate with Keycloak.
Probably you will have your own managed Keycloak instance running. If not, we give an example on how to deploy Keycloak behind reverse
proxy in our <a href="/diva-docs/docs/deployment/docker#deployment-with-nginx-reverse-proxy">Docker guide</a>.</p></li><li><p><code>VUE_APP_KEYCLOAK_REALM</code> - if you have your own managed Keycloak instance, you can specify the realm that the client should
use for user authentication. We ship DIVA with already preconfigured Keycloak instance that you can adjust. Otherwise, the default value ca be left as is.</p></li><li><p><code>VUE_APP_KEYCLOAK_CLIENT_ID</code> - the <code>id</code> of the Keycloak client that regulates the permission for our web-client.
No need to change this variable, if you use the Keycloak instance shipped with DIVA as is and do not have own managed Keycloak.</p></li><li><p><code>VUE_APP_REGISTER_AVAILABLE</code> </p><div type="tip" text="v3" vertical="middle"></div> - by default the Web Client login page provides
a link to the register page on Keycloak. If you want to disable the registration in Keycloak, this link can be deactivated and hidden.
Just set <code>VUE_APP_REGISTER_AVAILABLE</code> to <code>false</code>, empty string or let the variable empty. For example:<p></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VUE_APP_REGISTER_AVAILABLE=false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># or</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">VUE_APP_REGISTER_AVAILABLE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>VUE_APP_DISABLE_PATCH</code> </p><div type="tip" text="v3.3.1" vertical="middle"></div> - in the environments with the specific security
policies it is possible to disable PATCH requests. In this case all PATCH API requests will be mapped to POST. To disable PATCH requests
the variable should be set to <code>true</code>, e.g.:<p></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VUE_APP_DISABLE_PATCH=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p>You can read more about how to use environment variables in the <a href="/diva-docs/docs/deployment/docker#environment-variables">Docker guide</a>.
Please note that for the client to successfully and securely connect to Keycloak in the production environment and authenticate
in Kong, Kong and Keycloak must be configured correctly as well. At this point we refer the reader to the corresponding
<a href="#kong-gateway">Kong Gateway</a> and <a href="#keycloak">Keycloak</a> guides.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/diva-docs/docs/Deployment/docker"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Docker Deployment</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/diva-docs/docs/Deployment/releases"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Releases and Migrations</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#keycloak" class="table-of-contents__link toc-highlight">Keycloak</a><ul><li><a href="#environment" class="table-of-contents__link toc-highlight">Environment</a></li><li><a href="#realm" class="table-of-contents__link toc-highlight">Realm</a></li><li><a href="#authentication" class="table-of-contents__link toc-highlight">Authentication</a></li><li><a href="#users-management" class="table-of-contents__link toc-highlight">Users management</a></li></ul></li><li><a href="#kong-gateway" class="table-of-contents__link toc-highlight">Kong Gateway</a><ul><li><a href="#declarative-configuration" class="table-of-contents__link toc-highlight">Declarative Configuration</a></li></ul></li><li><a href="#web-client" class="table-of-contents__link toc-highlight">Web client</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Made by <a target="_blank" rel="noopener noreferrer" href="https://www.isst.fraunhofer.de/en.html">Fraunhofer ISST</a> with ❤️</div></div></div></footer></div>
<script src="/diva-docs/assets/js/runtime~main.8823692d.js"></script>
<script src="/diva-docs/assets/js/main.a798bc63.js"></script>
</body>
</html>