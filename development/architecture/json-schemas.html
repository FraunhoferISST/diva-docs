<!DOCTYPE html>
<html lang="en-US">
  <head>
    <link rel="icon" href="/logos/diva_logo_1000_1000.png"><title>Schemata   | DIVA Guide</title><meta name="description" content="DIVA  Documentation"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.15">
    <link rel="preload" href="/diva-docs/assets/js/runtime~app.79a8b393.js" as="script"><link rel="preload" href="/diva-docs/assets/css/styles.58093299.css" as="style"><link rel="preload" href="/diva-docs/assets/js/772.2e113ebf.js" as="script"><link rel="preload" href="/diva-docs/assets/js/app.5c06d636.js" as="script">
    <link rel="stylesheet" href="/diva-docs/assets/css/styles.58093299.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><span><a href="/diva-docs/" class=""><img class="logo" src="/diva-docs//logos/diva_logo_1000_1000.png" alt="DIVA Guide"><span class="site-name can-hide">DIVA Guide</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/diva-docs/about/" class="nav-link" aria-label="About DIVA"><!--[--><!--]--> About DIVA <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/diva-docs/user-docs/" class="nav-link" aria-label="Users Guide"><!--[--><!--]--> Users Guide <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/diva-docs/deployment/" class="nav-link" aria-label="Deployment"><!--[--><!--]--> Deployment <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/diva-docs/development/" class="nav-link router-link-active" aria-label="Development"><!--[--><!--]--> Development <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/FraunhoferISST/diva" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/diva-docs/about/" class="nav-link" aria-label="About DIVA"><!--[--><!--]--> About DIVA <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/diva-docs/user-docs/" class="nav-link" aria-label="Users Guide"><!--[--><!--]--> Users Guide <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/diva-docs/deployment/" class="nav-link" aria-label="Deployment"><!--[--><!--]--> Deployment <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/diva-docs/development/" class="nav-link router-link-active" aria-label="Development"><!--[--><!--]--> Development <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/FraunhoferISST/diva" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><a href="/diva-docs/development/" class="nav-link router-link-active sidebar-link" aria-label="Introduction"><!--[--><!--]--> Introduction <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/diva-docs/development/prerequisites.html" class="nav-link sidebar-link" aria-label="Prerequisites"><!--[--><!--]--> Prerequisites <!--[--><!--]--></a><!----><!--]--><!--[--><section class="sidebar-group"><p class="sidebar-heading active">Development</p><ul class=""><li><!--[--><section class="sidebar-group"><p class="sidebar-heading">Deployment</p><ul class="sidebar-sub-headers"><li><!--[--><a href="/diva-docs/development/deployment/local.html" class="nav-link sidebar-link" aria-label="Local development"><!--[--><!--]--> Local development <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/diva-docs/development/deployment/docker.html" class="nav-link sidebar-link" aria-label="Docker deployment"><!--[--><!--]--> Docker deployment <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading active">Architecture</p><ul class="sidebar-sub-headers"><li><!--[--><a href="/diva-docs/development/architecture/" class="nav-link router-link-active sidebar-link" aria-label="Overview"><!--[--><!--]--> Overview <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/diva-docs/development/architecture/json-schemas.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-link active" aria-label="Schemata  "><!--[--><!--]--> Schemata   <!--[--><!--]--></a><ul class="sidebar-sub-headers"><li><!--[--><a aria-current="page" href="/diva-docs/development/architecture/json-schemas.html#json-schema" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="JSON Schema"><!--[--><!--]--> JSON Schema <!--[--><!--]--></a><ul class="sidebar-sub-headers"><li><!--[--><a aria-current="page" href="/diva-docs/development/architecture/json-schemas.html#defining-a-schema" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Defining a schema"><!--[--><!--]--> Defining a schema <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/diva-docs/development/architecture/json-schemas.html#validation" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Validation"><!--[--><!--]--> Validation <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--></li><li><!--[--><a href="/diva-docs/development/architecture/rest-api.html" class="nav-link sidebar-link" aria-label="REST API"><!--[--><!--]--> REST API <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/diva-docs/development/architecture/keycloak.html" class="nav-link sidebar-link" aria-label="Keycloak"><!--[--><!--]--> Keycloak <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/diva-docs/development/architecture/gateway.html" class="nav-link sidebar-link" aria-label="Gateway"><!--[--><!--]--> Gateway <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/diva-docs/development/architecture/web-client.html" class="nav-link sidebar-link" aria-label="Web client"><!--[--><!--]--> Web client <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/diva-docs/development/architecture/tooling.html" class="nav-link sidebar-link" aria-label="Tooling"><!--[--><!--]--> Tooling <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--></li></ul></section><!--]--><!--[--><section class="sidebar-group"><p class="sidebar-heading">Contribution</p><ul class=""><li><!--[--><a href="/diva-docs/development/contribution/" class="nav-link sidebar-link" aria-label="How you can help"><!--[--><!--]--> How you can help <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/diva-docs/development/contribution/issues-and-prs.html" class="nav-link sidebar-link" aria-label="Issues and pull request"><!--[--><!--]--> Issues and pull request <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/diva-docs/development/contribution/commits.html" class="nav-link sidebar-link" aria-label="Committing changes"><!--[--><!--]--> Committing changes <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/diva-docs/development/contribution/code-styles.html" class="nav-link sidebar-link" aria-label="Code style guidance"><!--[--><!--]--> Code style guidance <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--]--></ul><!--[--><!--]--></aside><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="schemata"><a class="header-anchor" href="#schemata">#</a> Schemata</h1><p>To ensure high level of integrity and validity during write operations to the data storage and exchange of Kafka messages, we use <a href="https://json-schema.org/" target="_blank" rel="noopener noreferrer">JSON Schemas<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> and <a href="https://www.asyncapi.com/" target="_blank" rel="noopener noreferrer">AsyncAPI<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> accordingly.</p><h2 id="json-schema"><a class="header-anchor" href="#json-schema">#</a> JSON Schema</h2><p>JSON schemas are the fundamental building block of the whole DIVA architecture. In Diva 2 we have implemented a granular structured hierarchical schema system that has saved us a lot of unnecessary complexity and hundreds lines of code compared to DIVA 1.</p><p>Every existing piece of data in DIVA is well defined in a schema. DIVA never accepts data that is not explicitly defined in a schema. This in turn means that schemas are the first place in the system to be tweaked when developing new functionality. Schema-drive development engages us to first clearly define the data model and then start with implementation. However, the most important benefit comes from the fact that thanks to the JSON Schema tools we were able to implement fully automated validation of the data in our services.</p><p>You will find all the schemas in the <a href="https://github.com/FraunhoferISST/diva/blob/master/core/schemata/json-schema" target="_blank" rel="noopener noreferrer"><code>core/schemata/json-schema/</code><span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> directory. The directory is structured like follows:</p><ul><li><code>artifacts</code> - common reusable definitions</li><li><code>resource</code> - Resource and all subresources schemas</li><li><code>asset</code> - Asset and all subassets schemas</li><li><code>review</code> - Review schema</li><li><code>history</code> - History schema</li><li><code>user</code> - User schema</li></ul><p>Json schema determine our <a href="/diva-docs/development/architecture/#data-model" class="">data model</a>. Since the attributes of different resource types can vary significantly, we define other sub-resources such as PDF, CSV, PNG, etc. for the resources and assets. The type of sub-resource is generally determined by the format or type of data source. E.g. MongoDB, Hadoop or an API could be a sub-resource. The entity abstracts common attributes that are &quot;inherited&quot; by all other entities.</p><div data-v-a3bcba24><div class="grid grid-cols-3 gap-2 place-items-strech" data-v-a3bcba24><div data-v-a3bcba24></div><div class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>Entity</h4></div></div><div data-v-a3bcba24></div></div><div class="grid grid-cols-1 place-items-strech" data-v-a3bcba24><div class="connector center" data-v-a3bcba24 data-v-c0f5fcf6></div></div><div class="grid grid-cols-1 place-items-center" data-v-a3bcba24><div class="grid grid-cols-4 place-items-strech w-4/5" data-v-a3bcba24><div class="connector left top" data-v-a3bcba24 data-v-c0f5fcf6></div><div class="connector left right top middle" data-v-a3bcba24 data-v-c0f5fcf6></div><div class="connector right top middle" data-v-a3bcba24 data-v-c0f5fcf6></div><div class="connector right top" data-v-a3bcba24 data-v-c0f5fcf6></div></div></div><div class="grid grid-cols-5 gap-2 place-items-strech" data-v-a3bcba24><a href="/diva-docs/about/README.md#resource" class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>Resource</h4></div></a><a href="/diva-docs/about/README.md#user" class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>User</h4></div></a><a href="/diva-docs/about/README.md#review" class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>Review</h4></div></a><a href="/diva-docs/about/README.md#history" class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>History</h4></div></a><a href="/diva-docs/about/README.md#asset" class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>Asset</h4></div></a></div><div class="grid grid-cols-1" data-v-a3bcba24><div class="grid grid-cols-5 place-items-strech" data-v-a3bcba24><div class="connector center" data-v-a3bcba24 data-v-c0f5fcf6></div><div data-v-a3bcba24></div><div data-v-a3bcba24></div><div data-v-a3bcba24></div><div class="connector center" data-v-a3bcba24 data-v-c0f5fcf6></div></div></div><div class="grid grid-cols-1 place-items-center" data-v-a3bcba24><div class="grid grid-cols-5 place-items-strech w-4/5" data-v-a3bcba24><div class="connector left right top middle" data-v-a3bcba24 data-v-c0f5fcf6></div><div class="connector right top" data-v-a3bcba24 data-v-c0f5fcf6></div><div data-v-a3bcba24></div><div data-v-a3bcba24></div><div class="connector left right top middle" data-v-a3bcba24 data-v-c0f5fcf6></div></div></div><div class="grid grid-cols-6 gap-2 place-items-strech" data-v-a3bcba24><div class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>File</h4></div></div><div class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>UrbanPulse</h4></div></div><div class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>...</h4></div></div><div data-v-a3bcba24></div><div class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>...</h4></div></div><div class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>UrbanPulse</h4></div></div></div><div class="grid grid-cols-1" data-v-a3bcba24><div class="grid grid-cols-5 place-items-strech" data-v-a3bcba24><div class="connector center" data-v-a3bcba24 data-v-c0f5fcf6></div><div data-v-a3bcba24></div><div data-v-a3bcba24></div><div data-v-a3bcba24></div></div></div><div class="grid grid-cols-1 place-items-center" data-v-a3bcba24><div class="grid grid-cols-5 place-items-strech w-4/5" data-v-a3bcba24><div class="connector left right top middle" data-v-a3bcba24 data-v-c0f5fcf6></div><div class="connector right top" data-v-a3bcba24 data-v-c0f5fcf6></div><div data-v-a3bcba24></div></div></div><div class="grid grid-cols-6 gap-2 place-items-strech" data-v-a3bcba24><div class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>PDF</h4></div></div><div class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>CSV</h4></div></div><div class="item m-0" data-v-a3bcba24 data-v-9e8f7804><div class="item-container flex justify-center py-5 px-2" data-v-9e8f7804><h4 class="item-title m-0" data-v-9e8f7804>...</h4></div></div></div></div><div class="custom-container warning"><p class="custom-container-title">Bottom-to-top schemas</p><p>Practically, we define the schemas using the bottom-to-top approach. This means that the sub-resources do not extend the Resource schema, rather they are included in the Resource.</p></div><p>With the bottom-to-top approach, we include the subordinated schemas in the master schema according to certain conditions. Basically, for example, the resource schema contains all the schemas definition of the sub-resources. The advantages of this way of constructing the schemas are especially evident in automated validation.</p><p>We will take a <a href="https://github.com/FraunhoferISST/diva/blob/master/core/schemata/json-schema/resource/resource.json" target="_blank" rel="noopener noreferrer">Resource<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> example to demonstrate the approach:</p><div class="language-json ext-json"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;allOf&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;resourceType&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          ...
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;$ref&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/entity&quot;</span> <span class="token comment">// extend Entity schema</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// include sub-resource schema, if resourceType corresponds to this sub-resource</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;if&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;resourceType&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;const&quot;</span><span class="token operator">:</span> <span class="token string">&quot;urbanPulseSensor&quot;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;then&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;$ref&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/resourceUrbanPulseSensor&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This schema tells us that if we have an entity of type Resource and this Resource has type <code>urbanPulseSensor</code>, we need to validate against a composition of Entity, Resource and UrbanPulseSensor schemas.</p><h3 id="defining-a-schema"><a class="header-anchor" href="#defining-a-schema">#</a> Defining a schema</h3><p>The biggest disadvantage of schemas - they must be written. The important thing to note here is that each attribute has a strict and detailed definition. And as mentioned before, every possible piece of data must be described in a schema, whether it is a resource, user, etc. We will demonstrate the process of schema creation using a new resource type that should be added to Diva, e.g., Excel file resource.</p><p>First, we need to find the right place for the new scheme. Since we know that this will be a new file Resource, we follow the path below:</p><div class="language-text ext-text"><pre class="language-text"><code>schemata
└───json-schema
│   └───resources
│       │   resource.json
│       │   resourceFile.json
│       │   resourceFileApplicationPdf.json
│       │   ...
│       │   resourceFileExcel.json # our new definition for file Resource 
</code></pre></div><p>Next create a <code>resourceFileExcel.json</code> file and write down all required definitions here. You can use the existing schemas for other types as a guideline.</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Please define the schemas in detail and as strictly as possible! Always provide attributes with a title and description. Wherever it makes sense, define concrete type, format, value range etc. and give a couple of examples.</p></div><p>Since Excel is a file and a subtype of File Resource, we need to include the Excel Resource in <code>resourceFile.json</code> according to the bottom-to-top approach:</p><div class="language-json ext-json"><pre class="language-json"><code>
<span class="token comment">// resourceFile.json</span>
<span class="token punctuation">{</span>
  ...
      <span class="token property">&quot;if&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;properties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;mimeType&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;const&quot;</span><span class="token operator">:</span> <span class="token string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;then&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;$ref&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/resourceFileExcel&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This is the general procedure. There is no one ultimate pattern for schema creation for all possible resources in the world. Schema composition is a logical process and should be derived from the real world.</p><h3 id="validation"><a class="header-anchor" href="#validation">#</a> Validation</h3><p>There are many different tools in the JSON Schema ecosystem. For validating the data against a schema we use <a href="https://github.com/ajv-validator/ajv" target="_blank" rel="noopener noreferrer">ajv<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> library for Node.js. We recommend the use of similar tools for your programming language.</p><p>Generally all write operations to the main MongoDB storage must pass validation first. So all management services must always implement the validation. The management services like Resource or User Management fetch the required schema on a start time from the Schema Registry service. Important to note that the services have only to fetch the root schema (e.g. <code>resource.json</code> or <code>user.json</code>) thanks to the bottom-to-top approach and automated schema resolution in ajv. The services with read-only access to the entities can implement the validation, but do not have to.</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/FraunhoferISST/diva/edit/main/development/architecture/json-schemas.md" rel="noopener noreferrer" target="_blank" aria-label><!--[--><!--]-->  <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/diva-docs/development/architecture/" class="nav-link router-link-active" aria-label="Overview"><!--[--><!--]--> Overview <!--[--><!--]--></a></span><span class="next"><a href="/diva-docs/development/architecture/rest-api.html" class="nav-link" aria-label="REST API"><!--[--><!--]--> REST API <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main></div><!----><!--]--></div>
    <script src="/diva-docs/assets/js/runtime~app.79a8b393.js" defer></script><script src="/diva-docs/assets/js/772.2e113ebf.js" defer></script><script src="/diva-docs/assets/js/app.5c06d636.js" defer></script>
  </body>
</html>
